#$Language="VBScript"
#$Interface="1.0"

Sub Main()

    Dim rutaCarpetaSesiones, objFSO, objCarpeta, archivos, archivo, nombreSesion, comandos, comando, retardo

    ' Ruta a la carpeta que contiene las sesiones de SecureCRT (.ini)
    rutaCarpetaSesiones = "C:\ruta\a\tu\carpeta\de\sesiones"

    ' Lista de comandos a ejecutar en cada sesión
    comandos = Array("comando1", "comando2", "comando3")

    ' Retardo entre sesiones (en segundos)
    retardo = 10

    ' Crear objeto FileSystemObject
    Set objFSO = CreateObject("Scripting.FileSystemObject")

    ' Obtener la carpeta de sesiones
    Set objCarpeta = objFSO.GetFolder(rutaCarpetaSesiones)

    ' Obtener la colección de archivos en la carpeta
    Set archivos = objCarpeta.Files

    ' Bucle a través de los archivos (sesiones)
    For Each archivo In archivos

        ' Verificar si el archivo es una sesión de SecureCRT (.ini)
        If LCase(objFSO.GetExtensionName(archivo.Name)) = "ini" Then

            ' Obtener el nombre de la sesión (sin la extensión .ini)
            nombreSesion = objFSO.GetBaseName(archivo.Name)

            ' 1. Entrada automática (conexión)
            If crt.Session.Connect("/S " & nombreSesion) Then

                crt.Screen.Synchronous = True

                ' 2. Introducción de comandos
                For Each comando In comandos
                    crt.Screen.Send comando & vbCr
                    crt.Screen.WaitForString "$"
                Next

                ' 3. Salida automática (desconexión)
                crt.Session.Disconnect

                crt.Screen.Synchronous = False

            Else
                crt.Dialog.MessageBox "Error al conectar a la sesión " & nombreSesion
            End If

            ' Retardo antes de conectar a la siguiente sesión
            WScript.Sleep retardo * 1000

        End If

    Next

End Sub
